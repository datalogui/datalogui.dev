"use strict";(self.webpackChunkdatalogui_dev=self.webpackChunkdatalogui_dev||[]).push([[476],{3905:function(e,n,a){a.d(n,{Zo:function(){return u},kt:function(){return c}});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=t.createContext({}),d=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},u=function(e){var n=d(e.components);return t.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=d(a),c=r,g=m["".concat(s,".").concat(c)]||m[c]||p[c]||o;return a?t.createElement(g,i(i({ref:n},u),{},{components:a})):t.createElement(g,i({ref:n},u))}));function c(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<o;d++)i[d]=a[d];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5022:function(e,n,a){a.r(n),a.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return u},default:function(){return m}});var t=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],l={id:"usage",title:"Usage",sidebar_label:"Usage"},s=void 0,d={unversionedId:"usage",id:"usage",title:"Usage",description:"Creating a Table to store data",source:"@site/docs/Usage.md",sourceDirName:".",slug:"/usage",permalink:"/docs/usage",editUrl:"https://github.com/datalogui/datalogui.dev/edit/master/docs/Usage.md",tags:[],version:"current",frontMatter:{id:"usage",title:"Usage",sidebar_label:"Usage"},sidebar:"docs",next:{title:"React + Datalog",permalink:"/docs/react"}},u=[{value:"Creating a Table to store data",id:"creating-a-table-to-store-data",children:[],level:2},{value:"Adding data",id:"adding-data",children:[],level:2},{value:"Removing data",id:"removing-data",children:[],level:2},{value:"Querying data",id:"querying-data",children:[],level:2},{value:"Querying data \u2013 With Joins",id:"querying-data--with-joins",children:[],level:2},{value:"Querying data with Anti-Joins",id:"querying-data-with-anti-joins",children:[],level:2},{value:"Differential Updates",id:"differential-updates",children:[],level:2}],p={toc:u};function m(e){var n=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"creating-a-table-to-store-data"},"Creating a Table to store data"),(0,o.kt)("p",null,"This is analogous to a database table. To create a table call ",(0,o.kt)("inlineCode",{parentName:"p"},"datalog.newTable<T>(schema: Schema)"),". Bonus points for adding types to your schema."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import * as datalog from '@datalogui/datalog'\n\nconst People = datalog.newTable<{id: number, name: string}>({\n  id: datalog.NumberType,\n  name: datalog.StringType,\n})\n")),(0,o.kt)("h2",{id:"adding-data"},"Adding data"),(0,o.kt)("p",null,"Add data to the table with ",(0,o.kt)("inlineCode",{parentName:"p"},"table.assert(datum: T)"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'People.assert({id: 0, name: "Alice"})\nPeople.assert({id: 1, name: "Bob"})\n')),(0,o.kt)("h2",{id:"removing-data"},"Removing data"),(0,o.kt)("p",null,"Remove data from the table with ",(0,o.kt)("inlineCode",{parentName:"p"},"table.retract(datum: T)"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'People.retract({id: 1, name: "Bob"})\n')),(0,o.kt)("h2",{id:"querying-data"},"Querying data"),(0,o.kt)("p",null,"Query data from the table with the ",(0,o.kt)("inlineCode",{parentName:"p"},"datalog.query")," function:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'\n// Builds the structure of the query\nconst Query = datalog.query<{name: string}>(({name}) => {\n  People({name})\n})\n\n// Read the values of the query by creating a view into it\nQuery.view().readAllData()\n// => [{ name: "Alice" }]\n\n')),(0,o.kt)("h2",{id:"querying-data--with-joins"},"Querying data \u2013 With Joins"),(0,o.kt)("p",null,"Let's try a more complex example. How about listing every person's name and their manager's name."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'// ... People table is same as before\n\ntype ID = number\nconst Manages = datalog.newTable<{manager: ID, managee: ID}>({\n  manager: datalog.NumberType,\n  managee: datalog.NumberType,\n})\n\n// Find everyone who has a manager, and return their name and their manager\'s name\ndatalog.query<{\n  managerName: string,\n  personName: string,\n  personID: number,\n  managerID: number\n}>(({managerName, personName, managerID, personID}) => {\n  People({id: personID, name: personName})\n  Manages({managee: personID, manager: managerID})\n  People({id: managerID, name: managerName})\n})\n\nQuery.view().readAllData()\n// =>\n/*\n  [{\n      managerID: 0,\n      managerName: "Alice",\n      personID: 1,\n      personName: "Bob",\n  }]\n*/\n\n')),(0,o.kt)("h2",{id:"querying-data-with-anti-joins"},"Querying data with Anti-Joins"),(0,o.kt)("p",null,"It's also possible to say that something should not exist. This is declared with the ",(0,o.kt)("inlineCode",{parentName:"p"},".not")," method on tables inside queries. For example, let's find out who does not have a manager."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const Query = datalog.query<{ personID: number, personName: string }>(\n  ({ personName, personID }) => {\n    People({ id: personID })\n    // Here we say: Only find personID for which this condition does `not`\n    // hold. i.e. Find a personID such that there is\n    // not a {managee: personID} datum inside the Manages table.\n    Manages.not({ managee: personID })\n})\n\nQuery.view().readAllData()\n/*\n[{\n    personID: 0,\n    personName: "Alice",\n}]\n*/\n')),(0,o.kt)("h2",{id:"differential-updates"},"Differential Updates"),(0,o.kt)("p",null,"This Datalog implementation works off of differences. When you run a query, it doesn't run the query over the whole dataset every time. It only runs the query on new data. Let's see an example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'// Create our People table as before\nconst People = datalog.newTable<{ id: number, name: string }>({\n    id: datalog.NumberType,\n    name: datalog.StringType,\n})\n\nPeople.assert({ id: 0, name: "Alice" })\nconst Query = datalog.query<{ name: string }>(({ name }) => {\n    People({ name })\n})\n\nconst queryView = Query.view()\n\n// Ask only for recent data\nqueryView.recentData()\n// =>\n/*\n    [{\n        kind: datalog.Added,\n        datum: { name: "Alice" }\n    }]\n*/\n\n// Nothing has changed so we get nothing back\nqueryView.recentData()\n// => null\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"recentData")," returns either null or any changes that happened on this view\nsince the last time you called ",(0,o.kt)("inlineCode",{parentName:"p"},"recentData"),". Changes are either an addition of\na datum (represented by the ",(0,o.kt)("inlineCode",{parentName:"p"},"datalog.Added")," symbol) or a removal of a datum\n(represented by the ",(0,o.kt)("inlineCode",{parentName:"p"},"datalog.Removed")," symbol)."),(0,o.kt)("p",null,"Let's continue the example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'People.assert({ id: 2, name: "Eve" })\nqueryView.recentData()\n// => null\n')),(0,o.kt)("p",null,"Huh? What gives? Why did we get back null? It's because queries are a kind of\nlazy. Much like me, they won't do anything unless you ask them to. In this\ncase, we have to ask it to run the query again because we know the dependencies\n(The ",(0,o.kt)("inlineCode",{parentName:"p"},"People")," table) have changed. Let's try that again."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'// People.assert({ id: 2, name: "Eve" }) // We did this already\n// Hey Query! go ahead and run yourself\nQuery.runQuery()\nqueryView.recentData()\n/* =>\n[{\n    kind: datalog.Added,\n    datum: { name: "Eve" }\n}]\n*/\n')),(0,o.kt)("p",null,"That's better. We see the effect of our assertion in the People table reflected\nin the output of the query. But remembering to call ",(0,o.kt)("inlineCode",{parentName:"p"},"runQuery()")," every time can\nbe annoying. Thankfully we can add a small change to have the query\nautomatically run when any of its dependencies change."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Query.onDependencyChange(() => Query.runQuery())\n")),(0,o.kt)("p",null,"Now what happens when we remove something from the People table?"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'People.retract({ id: 2, name: "Eve" })\n// Note: runQuery is omitted here because it\'s happening\n// automatically because we ran\n// Query.onDependencyChange(() => Query.runQuery())\n\nqueryView.recentData()\n// =>\n/*\n[{\n    kind: datalog.Removed,\n    datum: { name: "Eve" }\n}]\n*/\n\n')),(0,o.kt)("p",null,"UIs don't change the whole state of the world very often. So it's much faster\nto run queries on differences rather than the full dataset every time. With DatalogUI, you get\nexpressive query syntax and good performance."))}m.isMDXComponent=!0}}]);